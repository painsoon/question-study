(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["user"],{1037:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-result",{attrs:{isSuccess:!0,content:!1,title:e.email,"sub-title":e.description},scopedSlots:e._u([{key:"extra",fn:function(){return[a("a-button",{attrs:{size:"large",type:"primary"}},[e._v("查看邮箱")]),a("a-button",{staticStyle:{"margin-left":"8px"},attrs:{size:"large"},on:{click:e.goHomeHandle}},[e._v("返回首页")])]},proxy:!0}])})},s=[],n={name:"RegisterResult",data:function(){return{description:"激活邮件已发送到你的邮箱中，邮件有效期为24小时。请及时登录邮箱，点击邮件中的链接激活帐户。",form:{}}},computed:{email:function(){var e=this.form&&this.form.email||"xxx";return"你的账户：".concat(e," 注册成功")}},created:function(){this.form=this.$route.params},methods:{goHomeHandle:function(){this.$router.push({name:"login"})}}},i=n,o=a("2877"),c=Object(o["a"])(i,r,s,!1,null,"5462d65e",null);t["default"]=c.exports},1348:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main user-layout-register"},[e._m(0),a("a-form",{ref:"formRegister",attrs:{form:e.form,id:"formRegister"}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["email",{rules:[{required:!0,type:"email",message:"请输入邮箱地址"}],validateTrigger:["change","blur"]}],expression:"['email', {rules: [{ required: true, type: 'email', message: '请输入邮箱地址' }], validateTrigger: ['change', 'blur']}]"}],attrs:{size:"large",type:"text",placeholder:"邮箱"}})],1),a("a-popover",{attrs:{placement:"rightTop",trigger:["focus"],getPopupContainer:function(e){return e.parentElement}},model:{value:e.state.passwordLevelChecked,callback:function(t){e.$set(e.state,"passwordLevelChecked",t)},expression:"state.passwordLevelChecked"}},[a("template",{slot:"content"},[a("div",{style:{width:"240px"}},[a("div",{class:["user-register",e.passwordLevelClass]},[e._v("强度："),a("span",[e._v(e._s(e.passwordLevelName))])]),a("a-progress",{attrs:{percent:e.state.percent,showInfo:!1,strokeColor:e.passwordLevelColor}}),a("div",{staticStyle:{"margin-top":"10px"}},[a("span",[e._v("请至少输入 6 个字符。请不要使用容易被猜到的密码。")])])],1)]),a("a-form-item",[a("a-input-password",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,message:"至少6位密码，区分大小写"},{validator:this.handlePasswordLevel}],validateTrigger:["change","blur"]}],expression:"['password', {rules: [{ required: true, message: '至少6位密码，区分大小写'}, { validator: this.handlePasswordLevel }], validateTrigger: ['change', 'blur']}]"}],attrs:{size:"large",placeholder:"至少6位密码，区分大小写"},on:{click:e.handlePasswordInputClick}})],1)],2),a("a-form-item",[a("a-input-password",{directives:[{name:"decorator",rawName:"v-decorator",value:["password2",{rules:[{required:!0,message:"至少6位密码，区分大小写"},{validator:this.handlePasswordCheck}],validateTrigger:["change","blur"]}],expression:"['password2', {rules: [{ required: true, message: '至少6位密码，区分大小写' }, { validator: this.handlePasswordCheck }], validateTrigger: ['change', 'blur']}]"}],attrs:{size:"large",placeholder:"确认密码"}})],1),a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["mobile",{rules:[{required:!0,message:"请输入正确的手机号",pattern:/^1[3456789]\d{9}$/},{validator:this.handlePhoneCheck}],validateTrigger:["change","blur"]}],expression:"['mobile', {rules: [{ required: true, message: '请输入正确的手机号', pattern: /^1[3456789]\\d{9}$/ }, { validator: this.handlePhoneCheck } ], validateTrigger: ['change', 'blur'] }]"}],attrs:{size:"large",placeholder:"11 位手机号"}},[a("a-select",{attrs:{slot:"addonBefore",size:"large",defaultValue:"+86"},slot:"addonBefore"},[a("a-select-option",{attrs:{value:"+86"}},[e._v("+86")]),a("a-select-option",{attrs:{value:"+87"}},[e._v("+87")])],1)],1)],1),a("a-row",{attrs:{gutter:16}},[a("a-col",{staticClass:"gutter-row",attrs:{span:16}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["captcha",{rules:[{required:!0,message:"请输入验证码"}],validateTrigger:"blur"}],expression:"['captcha', {rules: [{ required: true, message: '请输入验证码' }], validateTrigger: 'blur'}]"}],attrs:{size:"large",type:"text",placeholder:"验证码"}},[a("a-icon",{style:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"mail"},slot:"prefix"})],1)],1)],1),a("a-col",{staticClass:"gutter-row",attrs:{span:8}},[a("a-button",{staticClass:"getCaptcha",attrs:{size:"large",disabled:e.state.smsSendBtn},domProps:{textContent:e._s(e.state.smsSendBtn?e.state.time+" s":"获取验证码")},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.getCaptcha(t)}}})],1)],1),a("a-form-item",[a("a-button",{staticClass:"register-button",attrs:{size:"large",type:"primary",htmlType:"submit",loading:e.registerBtn,disabled:e.registerBtn},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.handleSubmit(t)}}},[e._v("注册 ")]),a("router-link",{staticClass:"login",attrs:{to:{name:"login"}}},[e._v("使用已有账户登录")])],1)],1)],1)},s=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("h3",[a("span",[e._v("注册")])])}],n=(a("498a"),a("5530")),i=a("7ded"),o=a("705f"),c={0:"低",1:"低",2:"中",3:"强"},l={0:"error",1:"error",2:"warning",3:"success"},u={0:"#ff0000",1:"#ff0000",2:"#ff7e05",3:"#52c41a"},d={name:"Register",components:{},mixins:[o["a"]],data:function(){return{form:this.$form.createForm(this),state:{time:60,smsSendBtn:!1,passwordLevel:0,passwordLevelChecked:!1,percent:10,progressColor:"#FF0000"},registerBtn:!1}},computed:{passwordLevelClass:function(){return l[this.state.passwordLevel]},passwordLevelName:function(){return c[this.state.passwordLevel]},passwordLevelColor:function(){return u[this.state.passwordLevel]}},methods:{handlePasswordLevel:function(e,t,a){var r=0;/[0-9]/.test(t)&&r++,/[a-zA-Z]/.test(t)&&r++,/[^0-9a-zA-Z_]/.test(t)&&r++,this.state.passwordLevel=r,this.state.percent=30*r,r>=2?(r>=3&&(this.state.percent=100),a()):(0===r&&(this.state.percent=10),a(new Error("密码强度不够")))},handlePasswordCheck:function(e,t,a){var r=this.form.getFieldValue("password");void 0===t&&a(new Error("请输入密码")),t&&r&&t.trim()!==r.trim()&&a(new Error("两次密码不一致")),a()},handlePhoneCheck:function(e,t,a){a()},handlePasswordInputClick:function(){this.isMobile?this.state.passwordLevelChecked=!1:this.state.passwordLevelChecked=!0},handleSubmit:function(){var e=this.form.validateFields,t=this.state,a=this.$router;e({force:!0},(function(e,r){e||(t.passwordLevelChecked=!1,a.push({name:"registerResult",params:Object(n["a"])({},r)}))}))},getCaptcha:function(e){var t=this;e.preventDefault();var a=this.form.validateFields,r=this.state,s=this.$message,n=this.$notification;a(["mobile"],{force:!0},(function(e,a){if(!e){r.smsSendBtn=!0;var o=window.setInterval((function(){r.time--<=0&&(r.time=60,r.smsSendBtn=!1,window.clearInterval(o))}),1e3),c=s.loading("验证码发送中..",0);Object(i["b"])({mobile:a.mobile}).then((function(e){setTimeout(c,2500),n["success"]({message:"提示",description:"验证码获取成功，您的验证码为："+e.result.captcha,duration:8})})).catch((function(e){setTimeout(c,1),clearInterval(o),r.time=60,r.smsSendBtn=!1,t.requestFailed(e)}))}}))},requestFailed:function(e){this.$notification["error"]({message:"错误",description:((e.response||{}).data||{}).message||"请求出现错误，请稍后再试",duration:4}),this.registerBtn=!1}},watch:{"state.passwordLevel":function(e){}}},p=d,m=(a("5d18"),a("67b4"),a("2877")),f=Object(m["a"])(p,r,s,!1,null,"3f44f627",null);t["default"]=f.exports},"313b":function(e,t,a){},"34c5":function(e,t,a){},5041:function(e,t,a){"use strict";var r=a("313b"),s=a.n(r);s.a},"5d18":function(e,t,a){"use strict";var r=a("eeab"),s=a.n(r);s.a},"67b4":function(e,t,a){"use strict";var r=a("34c5"),s=a.n(r);s.a},b56b:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main"},[a("h3",{staticClass:"title"},[e._v("管理后台")]),a("a-form-model",e._b({ref:"formLogin",staticClass:"user-layout-login",attrs:{layout:e.form.layout,model:e.form,rules:e.rules,id:"formLogin"},nativeOn:{submit:function(t){return t.preventDefault(),e.getLoginToken(t)}}},"a-form-model",e.formItemLayout,!1),[a("a-form-model-item",{attrs:{"label-col":{span:0},"wrapper-col":{span:24},prop:"sn"}},[a("a-input-group",[a("a-icon",{staticClass:"user-icon",attrs:{type:"user"}}),a("a-select",{staticStyle:{width:"88%"},attrs:{placeholder:"证书用户"},model:{value:e.form.sn,callback:function(t){e.$set(e.form,"sn",t)},expression:"form.sn"}},e._l(e.certList,(function(t,r){return a("a-select-option",{key:r,attrs:{value:t.sn}},[e._v(" "+e._s(t.ownerInfo.CN)+" ")])})),1)],1)],1),a("a-form-model-item",{attrs:{"label-col":{span:0},"wrapper-col":{span:24},prop:"password"}},[a("a-input-group",[a("a-input-password",{attrs:{placeholder:"证书密码"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}},[a("a-icon",{attrs:{slot:"addonBefore",type:"key"},slot:"addonBefore"})],1)],1)],1),a("a-form-model-item",{attrs:{"label-col":{span:0},"wrapper-col":{span:24}}},[a("a-button",{staticClass:"login-btn",attrs:{type:"primary",block:"",loading:e.loginLoading},on:{click:e.getLoginToken}},[e._v(" 登录 ")])],1),a("a-form-model-item",{attrs:{"label-col":{span:0},"wrapper-col":{span:24}}},[a("p",{staticClass:"downloadNewSheca",on:{click:function(t){return e.downLoadnewSheca()}}},[e._v(" 下载新版协卡助手 ")])])],1)],1)},s=[],n=(a("c975"),a("96cf"),a("1da1")),i=a("b775"),o="http://127.0.0.1:18455",c=function(e){return i["b"].request({url:"".concat(o,"/uk/action"),method:"POST",data:{type:100}})},l=function(e){var t=e.keySN,a=e.asymid,r=e.usage;return i["b"].request({url:"".concat(o,"/uk/action"),method:"POST",data:{keySN:t,asymid:a,usage:r,type:200}})},u=function(e){var t=e.keySN,a=e.asymid,r=e.pin;return i["b"].request({url:"".concat(o,"/uk/action"),method:"POST",data:{keySN:t,asymid:a,pin:r,type:101}})},d=function(e){var t=e.keySN,a=e.asymid,r=e.pin,s=e.raw,n=e.signDataType,c=e.signMethodID;return i["b"].request({url:"".concat(o,"/uk/action"),method:"POST",data:{keySN:t,asymid:a,pin:r,raw:s,signDataType:n,signMethodID:c,type:300}})},p=function(e){var t=e.keySN,a=e.asymid,r=e.pin,s=e.raw,n=e.signDataType,c=e.signMethodID;return i["b"].request({url:"".concat(o,"/uk/action"),method:"POST",data:{keySN:t,asymid:a,pin:r,raw:s,signDataType:n,signMethodID:c,type:301}})},m=function(e){var t=e.keySN,a=e.asymid,r=e.pin,s=e.newPin;return i["b"].request({url:"".concat(o,"/uk/action"),method:"POST",data:{keySN:t,asymid:a,pin:r,newPin:s,type:500}})},f=function(e){var t=e.cert,a=e.asymid,r=e.raw,s=e.signDataType;return i["b"].request({url:"".concat(o,"/uk/action"),method:"POST",data:{cert:t,asymid:a,raw:r,signDataType:s,type:303}})},g=function(e){var t=e.keySN,a=e.asymid,r=e.raw,s=e.pin;return i["b"].request({url:"".concat(o,"/uk/action"),method:"POST",data:{keySN:t,asymid:a,raw:r,pin:s}})},h=function(e){var t=e.keySN,a=e.pin,r=e.asymid,s=e.dn,n=e.modLen;return i["b"].request({url:"".concat(o,"/uk/action"),method:"POST",data:{keySN:t,pin:a,asymid:r,dn:s,modLen:n,type:400}})},v=function(e){var t=e.keySN,a=e.pin,r=e.asymid,s=e.cert;return i["b"].request({url:"".concat(o,"/uk/action"),method:"POST",data:{keySN:t,pin:a,asymid:r,cert:s,type:401}})},y=function(e){var t=e.keySN,a=e.pin,r=e.asymid,s=e.cert,n=e.algID,c=e.encKey;return i["b"].request({url:"".concat(o,"/uk/action"),method:"POST",data:{keySN:t,pin:a,asymid:r,cert:s,algID:n,encKey:c,type:403}})},w=function(e){var t=e.asymid,a=e.keySN,r=e.pin,s=e.certChain;return i["b"].request({url:"".concat(o,"/uk/action"),method:"POST",data:{asymid:t,keySN:a,pin:r,certChain:s,type:402}})},k=function(e){var t=e.keySN;return i["b"].request({url:"".concat(o,"/uk/action"),method:"POST",data:{keySN:t,type:203}})},S=function(e){var t=e.keySN,a=e.pin,r=e.usage,s=e.seal;return i["b"].request({url:"".concat(o,"/uk/action"),method:"POST",data:{keySN:t,pin:a,usage:r,seal:s,type:404}})},b=function(e){var t=e.keySN,a=e.pin,r=e.raw,s=e.asymid,n=e.wrapperType,c=e.signMethodID;return i["b"].request({url:"".concat(o,"/uk/action"),method:"POST",data:{keySN:t,pin:a,raw:r,asymid:s,wrapperType:n,signMethodID:c,type:300}})},L={post_ukey_list:c,post_ukey_cert:l,post_check_pin:u,post_sign:d,post_check_sign:p,post_change_pin:m,post_encode_enveloper:f,post_decode_enveloper:g,post_get_p10:h,post_save_cert:v,post_save_cert2:y,post_CertChain:w,CertSign:k,saveSignImg:S,saveSign:b},C=a("c24f"),_=a("8ded"),N=a.n(_),x={name:"LoginForm",data:function(){return{form:{userName:null,password:null,randomOrigin:null,sn:void 0},certList:[],rules:{sn:[{required:!0,message:"账号不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}]},ukeyList:[],localCertList:[],selectedKeySn:null,selectedAsymid:null,loginLoading:!1}},computed:{formItemLayout:function(){return{labelCol:{span:5},wrapperCol:{span:18,offset:1}}}},created:function(){window.shecaSDKInstance=window.SheCaSDK.UkJsBridge,this.getRandomOrigin(),this.listionUkeyList()},mounted:function(){this.getUkeyList()},methods:{getUkeyList:function(){var e=this;L.post_ukey_list().then((function(t){e.ukeyList=JSON.parse(t.data.data)})).then((function(){e.getUkeyCert(e.ukeyList)}))},findRasAndSm2:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r={keySN:e,asymid:1,usage:2},s={keySN:e,asymid:2,usage:2},a.next=4,L.post_ukey_cert(r).then((function(e){var a=e.data;if(0===+a.code){var s=SheCaSDK.Util.certificateDecoder(a.data).sn.value;r.certSn=s,r.cert=a.data}t.localCertList.push(r)}));case 4:return a.next=6,L.post_ukey_cert(s).then((function(e){var a=e.data;if(0===+a.code){var r=SheCaSDK.Util.certificateDecoder(a.data).sn.value;s.certSn=r,s.cert=a.data}t.localCertList.push(s)}));case 6:localStorage.removeItem("certList"),localStorage.setItem("certList",JSON.stringify(t.localCertList)),sessionStorage.removeItem("certList"),sessionStorage.setItem("certList",JSON.stringify(t.localCertList));case 10:case"end":return a.stop()}}),a)})))()},getUkeyCert:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var r,s,n,i,o,c,l,u,d,p,m;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.localCertList=[],r={},!(e.length<=0)){a.next=7;break}return t.certList=[],t.form.sn=void 0,t.form.password="",a.abrupt("return");case 7:s=0;case 8:if(!(s<e.length)){a.next=14;break}return a.next=11,t.findRasAndSm2(e[s].keySN);case 11:s++,a.next=8;break;case 14:for(n=JSON.parse(sessionStorage.getItem("certList")),i=0;i<n.length;i++)null!=n[i].cert&&"undefined"!=n[i].cert&&(o=SheCaSDK.Util.certificateDecoder(n[i].cert).sn,c=SheCaSDK.Util.certificateDecoder(n[i].cert).ownerInfo,l=SheCaSDK.Util.certificateDecoder(n[i].cert).date,u=SheCaSDK.Util.certificateDecoder(n[i].cert).algorithm,d=SheCaSDK.Util.certificateDecoder(n[i].cert).issueerInfo,p=SheCaSDK.Util.certificateDecoder(n[i].cert).certBase64,r[o.value]={},r[o.value]["sn"]=o.value,r[o.value]["algorithm"]=u.value,r[o.value]["ownerInfo"]=c.value,r[o.value]["date"]=l.value,r[o.value]["certBase64"]=p.value,r[o.value]["issueerInfo"]=d.value,r[o.value]["asymid"]=n[i].asymid,r[o.value]["usage"]=n[i].usage,r[o.value]["keySN"]=n[i].keySN);for(i in t.certList=r,m=[],t.certList)m.push(t.certList[i]);t.form.sn=m[0].sn;case 20:case"end":return a.stop()}}),a)})))()},handleSubmit:function(){this.selectedKeySn,this.selectedAsymid,this.form.password,this.form.randomOrigin},getToken:function(){var e=this,t=this,a={keySN:this.selectedKeySn,asymid:this.selectedAsymid,pin:this.form.password,raw:t.form.randomOrigin,signDataType:1,signMethodID:0};L.post_sign(a).then((function(t){if(e.Encrypt(),0==t.data.code){var a=t.data.data;e.getLoginToken(a)}else e.$Notice.error({title:"提示",dsec:"签名失败，错误代码："+t.code})}))},Encrypt:function(){},getRandomOrigin:function(){},getLoginToken:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a,r,s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$refs.formLogin.validate((function(e){})),t.loginLoading=!0,e.prev=2,e.next=5,t.checkPin();case 5:if(a=e.sent,0!=a.code){e.next=16;break}return r={certSn:t.form.sn,personalName:t.form.userName,keySn:t.selectedKeySn},e.next=10,Object(C["b"])(r);case 10:s=e.sent,n=s.data,0===n.code?(N.a.set("X-EDIMS-TOKEN",n.result.token),t.$store.commit("SET_TOKEN",n.result.token),localStorage.setItem("username",n.result.uname),t.$router.push({path:"/"})):t.$message.error(n.msg),t.$emit("SET_TOKEN",a.token),e.next=17;break;case 16:t.$message.error("密码错误！");case 17:t.loginLoading=!1,e.next=24;break;case 20:e.prev=20,e.t0=e["catch"](2),t.loginLoading=!1,t.$message.error(e.t0.msg);case 24:case"end":return e.stop()}}),e,null,[[2,20]])})))()},checkPin:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={keySN:e.selectedKeySn,asymid:e.selectedAsymid,pin:e.form.password},t.next=3,L.post_check_pin(a);case 3:return r=t.sent,s=r.data,t.abrupt("return",s);case 6:case"end":return t.stop()}}),t)})))()},downLoadnewSheca:function(){this.OSnow()},OSnow:function(){var e=navigator.userAgent.toLowerCase(),t=/macintosh|mac os x/i.test(navigator.userAgent);(e.indexOf("win32")>=0||e.indexOf("wow32")>=0)&&(location.href="/exe/NewXieKaSetup.exe"),(e.indexOf("win64")>=0||e.indexOf("wow64")>=0)&&(location.href="/exe/NewXieKaSetup.exe"),t&&(location.href="/exe/NewXieKaMac.zip")},listionUkeyList:function(){var e=this,t=new WebSocket("ws://127.0.0.1:18455");t.onmessage=function(t){t.data&&e.getUkeyList()}}},watch:{"form.sn":function(e){var t=this.certList;for(var a in t)t[a]["sn"]==e&&(this.selectedAsymid=t[a].asymid,this.form.userName=t[a].ownerInfo.CN,this.form.sn=t[a].sn,this.selectedKeySn=t[a].keySN,localStorage.setItem("selectKeySn",t[a].keySN))}}},T=x,O=(a("5041"),a("2877")),D=Object(O["a"])(T,r,s,!1,null,"261edbac",null);t["default"]=D.exports},eeab:function(e,t,a){}}]);